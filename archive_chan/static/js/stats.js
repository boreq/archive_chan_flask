var statsData,timeout;$(window).resize(function(){drawChart(statsData)});$(document).ready(function(){update();$(".last-update-info").on("click","#update-now",function(){update()});if(info_data.thread){$("#value-average-thread").closest("li").hide();$("#value-total-threads").closest("li").hide()}});function update(){clearTimeout(timeout);$("#update-now i").addClass("fa-spin");request_data={};if(info_data.thread){request_data.thread=info_data.thread}if(info_data.board){request_data.board=info_data.board}var a=$.ajax({url:info_data.api_url,data:request_data,dataType:"json"}).done(function(c){statsData=c;drawStats(c);drawChart(c);var b=new Date();$("#last-update").attr("datetime",b.toISOString()).attr("title",b).data("timeago",null).timeago()}).always(function(){timeout=setTimeout(update,15*1000);$("#update-now i").removeClass("fa-spin")})}function drawStats(b){$("#value-total-threads").text(b.total_threads);$("#value-total-posts").text(b.total_posts);$("#value-total-text").text(b.total_posts-b.total_image_posts);$("#value-total-image").text(b.total_image_posts);var a=b.recent_posts/b.recent_posts_timespan;if(a>10){a=Math.round(a)}else{a=Math.round(a*100)/100}$("#value-average-hour").text(a);if(b.total_threads>0){$("#value-average-thread").text(Math.round(b.total_posts/b.total_threads))}else{$("#value-average-thread").text("0")}if(b.total_posts>0){$("#value-percent-image").text(Math.round(b.total_image_posts/b.total_posts*100)+"%")}else{$("#value-percent-image").text("0%")}}function drawChart(b){var a={color:"#65c6bb",data:b.chart_data,label:"Posts per hour"};$.plot("#chart",[a],{lines:{show:true},legend:{show:false},xaxis:{mode:"time",minTickSize:[1,"hour"],autoscaleMargin:0.02}})};